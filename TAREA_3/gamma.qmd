---
title: "Distribuci√≥n Gamma"
lang: es
---

```{=html}
<style>
main.content {
text-align: justify}
</style>
```

```{r}
#| label: setup
#| include: false

library(ggplot2)
library(dplyr)
library(gridExtra)
library(knitr)
library(kableExtra)
library(RColorBrewer)
library(plotly)
```

## Funci√≥n Gamma

Antes de estudiar la distribuci√≥n gamma, es fundamental comprender la **funci√≥n gamma**, que es la base matem√°tica de esta distribuci√≥n y una generalizaci√≥n del factorial para los n√∫meros reales.

::: {#def-funcion_gamma}
La **funci√≥n gamma** se define por medio de la siguiente integral impropia:

$$\Gamma(\alpha) = \int_{0}^{\infty} t^{\alpha -1} e^{-t} dt, \quad \alpha > 0$$

Esta integral impropia converge para todos los valores reales $\alpha > 0$ y para todos los n√∫meros complejos con parte real positiva.
:::

### Propiedades Fundamentales de la Funci√≥n Gamma

**1. Relaci√≥n de Recurrencia**

La propiedad m√°s importante de la funci√≥n gamma es:

$$\Gamma(\alpha +1) = \alpha  \Gamma(\alpha)$$

**2. Relaci√≥n con el Factorial**

Para n√∫meros enteros positivos $n$:

$$\Gamma(n+1) = (n)!$$

**3. Valores Especiales**

```{r}
#| label: valores-especiales-gamma

# Calcular algunos valores especiales de la funci√≥n gamma
valores_especiales <- data.frame(
  `Œ±` = c(1, 2, 3, 4, 5, 0.5, 1.5, 2.5, 3.5),
  `Gamma(Œ±)` = c(
    gamma(1), gamma(2), gamma(3), gamma(4), gamma(5),
    gamma(0.5), gamma(1.5), gamma(2.5), gamma(3.5)
  ),
  `Equivalencia` = c(
    "0!", "1!", "2!", "3!", "4!",
    "‚àöœÄ", "‚àöœÄ/2", "3‚àöœÄ/4", "15‚àöœÄ/8"
  ),
  check.names = FALSE
)

kable(valores_especiales,
      caption = "Valores especiales de la funci√≥n gamma", align = 'c',
      digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))
```

<br>

**4. Visualizaci√≥n de la Funci√≥n Gamma**

```{r}
#| label: visualizacion-gamma

# Crear gr√°fico de la funci√≥n gamma
x_vals <- seq(0.1, 5, length.out = 1000)
y_vals <- gamma(x_vals)

# Identificar puntos especiales
puntos_especiales <- data.frame(
  x = c(1, 2, 3, 4, 5, 0.5, 1.5, 2.5),
  y = gamma(c(1, 2, 3, 4, 5, 0.5, 1.5, 2.5)),
  etiqueta = c("Œì(1)=1", "Œì(2)=1", "Œì(3)=2", "Œì(4)=6", "Œì(5)=24", 
               "Œì(1/2)=‚àöœÄ", "Œì(3/2)", "Œì(5/2)")
)

ggplot(data.frame(x = x_vals, y = y_vals), aes(x = x, y = y)) +
  geom_line(linewidth = 1.5, color = "blue") +
  geom_point(data = puntos_especiales, aes(x = x, y = y), 
             color = "red", size = 3) +
  geom_label(data = puntos_especiales[1:6,], aes(x = x, y = y, label = etiqueta),
            vjust = -0.5, hjust = 0.5, size = 4) +
  labs(title = "Funci√≥n Gamma Œì(Œ±)",
       x = "Œ±", y = "Œì(Œ±)") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5)) +
  xlim(0, 5) +
  ylim(0, 25)
```

## Descripci√≥n de la Variable Aleatoria y Definici√≥n

La **distribuci√≥n gamma** es una familia de distribuciones continuas extremadamente vers√°til que surge naturalmente en m√∫ltiples contextos estad√≠sticos y aplicados. Su importancia radica en su capacidad para modelar una amplia variedad de fen√≥menos que involucran **tiempos de espera**, **sumas de variables aleatorias** y **procesos de llegada**.

La distribuci√≥n gamma es fundamental para modelar:

-   **Tiempo hasta la k-√©sima falla** en sistemas con m√∫ltiples componentes
-   **Tiempo de procesamiento** de tareas que requieren m√∫ltiples etapas
-   **Modelado de lluvias** y precipitaciones acumuladas
-   **An√°lisis de supervivencia** con tasas de riesgo variables
-   **Distribuciones a priori** en estad√≠stica bayesiana
-   **Suma de variables exponenciales** independientes

::: {#def-dist_gamma}
Una variable aleatoria continua $X$ sigue una **distribuci√≥n gamma** si tiene funci√≥n de densidad de probabilidad:

$$f(x) = \frac{(\lambda x)^{\alpha-1}}{\Gamma(\alpha)} \lambda e^{-\lambda x}, \quad x > 0$$

donde:

-   $\alpha > 0$ es el **par√°metro de forma** (shape parameter)
-   $\lambda > 0$ es el **par√°metro de tasa** (rate parameter)
-   $\Gamma(\alpha)$ es la funci√≥n gamma evaluada en $\alpha$

A una variable aleatoria con distribuci√≥n gamma la denotamos como $X \sim \text{gamma}(\alpha, \lambda)$
:::

------------------------------------------------------------------------

### Casos Especiales Importantes

La distribuci√≥n gamma incluye varias distribuciones conocidas como casos especiales:

**1. Distribuci√≥n Exponencial**

Cuando $\alpha = 1$: $$\text{gamma}(1, \lambda) = \text{exp}(\lambda)$$

**2. Distribuci√≥n Chi-cuadrada**

Cuando $\alpha = \frac{\nu}{2}$ y $\lambda = \frac{1}{2}$: $$\text{gamma}\left(\frac{\nu}{2}, \frac{1}{2}\right) = \chi^2(\nu)$$

**3. Distribuci√≥n Erlang**

Cuando $\alpha$ es un entero positivo $k$: $$\text{gamma}(k, \lambda) = \text{Erlang}(k, \lambda)$$

### Interpretaci√≥n de los Par√°metros

**Par√°metro de Forma (**$\alpha$)

-   $\alpha < 1$: Distribuci√≥n en forma de "J" invertida, altamente sesgada
-   $\alpha = 1$: Distribuci√≥n exponencial (decrecimiento mon√≥tono)
-   $\alpha > 1$: Distribuci√≥n unimodal con sesgo positivo
-   $\alpha \gg 1$: Distribuci√≥n aproximadamente sim√©trica (normal)

**Par√°metro de Tasa (**$\lambda$)

-   $\lambda$ peque√±o: Distribuci√≥n m√°s dispersa, valores m√°s grandes probables
-   $\lambda$ grande: Distribuci√≥n m√°s concentrada, valores m√°s peque√±os probables
-   **Efecto de escala**: $\lambda$ act√∫a como un factor de escala inverso

```{r}
#| label: interpretacion-parametro-alpha

# Visualizaci√≥n del efecto de los par√°metros
x_seq <- seq(0, 8, length.out = 500)

# Efecto del par√°metro Œ± (forma)
alpha_vals <- c(0.5, 1, 2, 3, 5)
lambda_fijo <- 1

df_alpha <- data.frame()
for (a in alpha_vals) {
  temp <- data.frame(
    x = x_seq,
    y = dgamma(x_seq, shape = a, rate = lambda_fijo),
    parametro = paste("Œ± =", a)
  )
  df_alpha <- rbind(df_alpha, temp)
}

# Crear gr√°fico
alpha_effect <- ggplot(df_alpha, aes(x = x, y = y, color = parametro)) +
  geom_line(linewidth = 1.2) +
  labs(title = "Efecto del Par√°metro Œ± en la Distribuci√≥n Gamma",
       subtitle = paste("Œª =", lambda_fijo),
       x = "x", y = "f(x)",
       color = "Par√°metro") +
  scale_color_brewer(palette="Dark2")+
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5)) +
  xlim(0, 8.1)

ggplotly(alpha_effect)
```

```{r}
#| label: interpretacion-parametro-lambda

# Efecto del par√°metro Œ≤ (tasa)
alpha_fijo <- 2
lambda_vals <- c(0.5, 1, 1.5, 2, 3)

df_lambda <- data.frame()
for (b in lambda_vals) {
  temp <- data.frame(
    x = x_seq,
    y = dgamma(x_seq, shape = alpha_fijo, rate = b),
    parametro = paste("Œª =", b)
  )
  df_lambda <- rbind(df_lambda, temp)
}

# Crear gr√°fico
lambda_effect <- ggplot(df_lambda, aes(x = x, y = y, color = parametro)) +
  geom_line(linewidth = 1.2) +
  labs(title = "Efecto del Par√°metro Œ≤ en la Distribuci√≥n Gamma",
       subtitle = paste("Œ± =", alpha_fijo),
       x = "x", y = "f(x)",
       color = "Par√°metro") +
  scale_color_brewer(palette="Dark2")+
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5)) +
  xlim(0, 8.1)

ggplotly(lambda_effect)
```

## Propiedades de la Funci√≥n de Densidad de Probabilidad

La funci√≥n de densidad de probabilidad de la distribuci√≥n gamma puede escribirse como:

$$f(x) = \frac{\lambda^\alpha}{\Gamma(\alpha)} x^{\alpha-1} e^{-\lambda x}, \quad x > 0$$

La cual, puede descomponerse en tres componentes principales:

1.  **Factor de normalizaci√≥n**: $\frac{\lambda^\alpha}{\Gamma(\alpha)}$
2.  **Componente de potencia**: $x^{\alpha-1}$
3.  **Componente exponencial**: $e^{-\lambda x}$

**An√°lisis del Comportamiento en x = 0**

El comportamiento de $f(x)$ cuando $x \to 0^+$ depende crucialmente del par√°metro de forma $\alpha$:

$$\lim_{x \to 0} f(x) = \lim_{x \to 0} \frac{(\lambda x)^{\alpha-1}}{\Gamma(\alpha)} \lambda e^{-\lambda x}$$

-   **Si Œ± \> 1**: $\lim_{x \to 0} f(x) = 0$
-   **Si Œ± = 1**: $\lim_{x \to 0} f(x) = \frac{\lambda}{\Gamma(1)} = \lambda$
-   **Si 0 \< Œ± \< 1**: $\lim_{x \to 0} f(x) = +\infty$

**Moda de la Distribuci√≥n**

Para encontrar la moda, calculamos $f'(x) = 0$:

$$f'(x) = \frac{\lambda^\alpha}{\Gamma(\alpha)} \left[(\alpha-1)x^{\alpha-2}e^{-\lambda x} - \lambda x^{\alpha-1}e^{-\lambda x}\right]$$

$$= \frac{\lambda^\alpha}{\Gamma(\alpha)} x^{\alpha-2} e^{-\lambda x} \left[(\alpha-1) - \lambda x\right]$$

Igualando a cero: $(\alpha-1) - \lambda x = 0$

-   **Si Œ± \> 1**: Moda = $\frac{\alpha-1}{\lambda}$
-   **Si Œ± = 1**: No hay moda (distribuci√≥n exponencial)
-   **Si Œ± \< 1**: Moda = 0

**Visualizaci√≥n Detallada del Comportamiento**

```{r}
#| label: visualizacion-comportamiento
#| warning: false

lambda_fijo <- 1.5

# Crear gr√°fico mostrando diferentes comportamientos
x_detalle <- seq(0.01, 6, length.out = 1000)
alpha_casos <- c(0.5, 1, 2, 4)
colores <- c("red", "blue", "green", "purple")

df_casos <- data.frame()
for (i in seq_along(alpha_casos)) {
  alpha_i <- alpha_casos[i]
  temp <- data.frame(
    x = x_detalle,
    y = dgamma(x_detalle, shape = alpha_i, rate = lambda_fijo),
    caso = paste("Œ± =", alpha_i)
  )
  df_casos <- rbind(df_casos, temp)
}

# Agregar puntos de las modas
df_modas <- data.frame(
  x = c(0, NA, (2-1)/lambda_fijo, (4-1)/lambda_fijo),
  y = c(Inf, NA, dgamma((2-1)/lambda_fijo, 2, lambda_fijo), dgamma((4-1)/lambda_fijo, 4, lambda_fijo)),
  caso = paste("Œ± =", alpha_casos)
) %>% filter(!is.na(x) & is.finite(y))

p1 <- ggplot(df_casos, aes(x = x, y = y, color = caso)) +
  geom_line(linewidth = 1.2) +
  geom_point(data = df_modas, aes(x = x, y = y), size = 3, color = "black") +
  geom_point(data = df_modas, aes(x = x, y = y, color = caso), size = 2) +
  labs(title = "Comportamiento de la PDF Gamma seg√∫n Œ±",
       subtitle = paste("Œª =", lambda_fijo),
       x = "x", y = "f(x)",
       color = "Par√°metro Œ±") +
  scale_color_brewer(palette="Dark2")+
  theme_minimal() +
  guides(color = guide_legend(position = "inside")) +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5), 
        legend.position.inside = c(0.5, 0.7)) +
  xlim(0, 6.1) +
  ylim(0, 2)

# Gr√°fico de zoom cerca del origen para Œ± < 1
x_zoom <- seq(0.001, 1, length.out = 1000)
df_zoom <- data.frame(
  x = x_zoom,
  y = dgamma(x_zoom, shape = 0.5, rate = lambda_fijo),
  caso = "Œ± = 0.5"
)

p2 <- ggplot(df_zoom, aes(x = x, y = y)) +
  geom_line(linewidth = 1.2, color = "red") +
  labs(title = "Comportamiento cerca del origen (Œ± = 0.5)",
       x = "x", y = "f(x)") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5)) +
  xlim(0, 1) +
  ylim(0, 5)

grid.arrange(p1, p2, ncol = 2)
```

<br>

**Derivada de la PDF**

$$f'(x) = \frac{\lambda^\alpha}{\Gamma(\alpha)} x^{\alpha-2} e^{-\lambda x} \left[(\alpha-1) - \lambda x\right]$$

An√°lisis del signo:

-   Para $x < \frac{\alpha-1}{\lambda}$: $f'(x) > 0$ (funci√≥n creciente)
-   Para $x > \frac{\alpha-1}{\lambda}$: $f'(x) < 0$ (funci√≥n decreciente)

**Comportamiento Asint√≥tico**

Cuando $x \to \infty$: $$f(x) \sim \frac{\lambda^\alpha}{\Gamma(\alpha)} x^{\alpha-1} e^{-\lambda x} \to 0$$

El decaimiento es **exponencial**, m√°s r√°pido que cualquier funci√≥n polinomial.

## Propiedades de la Funci√≥n de Distribuci√≥n (CDF)

::: {#def-cdf_gamma}
La funci√≥n de distribuci√≥n acumulativa (CDF) de la distribuci√≥n gamma se define como:

$$F(x) = P(X \leq x) = \int_{0}^{x} \frac{(\lambda t)^{\alpha-1}}{\Gamma(\alpha)} \lambda e^{-\lambda t} dt$$

Para $x > 0$, y $F(x) = 0$ para $x \leq 0$.
:::

### Efecto de los Par√°metros en la CDF

```{r}
#| label:  visualizacion_cdf

# Crear secuencia de valores x
x_vals <- seq(0, 8, length.out = 1000)

# Diferentes valores de Œ± (forma) con Œ≤ fijo
alpha_vals <- c(0.5, 1, 2, 3, 5)
lambda_fijo <- 1.5

df_alpha_cdf <- data.frame()
for (a in alpha_vals) {
  temp <- data.frame(
    x = x_vals,
    y = pgamma(x_vals, shape = a, rate = lambda_fijo),
    parametro = paste("Œ± =", a),
    tipo = "Efecto de Œ± (Œª = 1.5)"
  )
  df_alpha_cdf <- rbind(df_alpha_cdf, temp)
}

# Diferentes valores de Œ≤ (tasa) con Œ± fijo
alpha_fijo <- 2
lambda_vals <- c(0.5, 1, 1.5, 2, 3)

df_lambda_cdf <- data.frame()
for (b in lambda_vals) {
  temp <- data.frame(
    x = x_vals,
    y = pgamma(x_vals, shape = alpha_fijo, rate = b),
    parametro = paste("Œª =", b),
    tipo = "Efecto de Œª (Œ± = 2)"
  )
  df_lambda_cdf <- rbind(df_lambda_cdf, temp)
}

# Combinar dataframes
df_cdf_efectos <- rbind(df_alpha_cdf, df_lambda_cdf)

# Crear gr√°ficos
ggplot(df_cdf_efectos, aes(x = x, y = y, color = parametro)) +
  geom_line(linewidth = 1.2) +
  geom_hline(yintercept = c(0, 0.5, 1), linetype = "dashed", alpha = 0.5) +
  facet_wrap(~tipo, scales = "free_x", ncol = 2) +
  labs(title = "Funci√≥n de Distribuci√≥n Acumulativa - Distribuci√≥n Gamma",
       subtitle = "Efecto de los par√°metros Œ± y Œª",
       x = "x", y = "F(x) = P(X ‚â§ x)",
       color = "Par√°metro") +
  scale_color_brewer(palette="Paired")+
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5)) +
  ylim(0, 1)
```

### Comparaci√≥n: PDF vs CDF

```{r}
#| label: comparacion_pdf_cdf

# Comparar PDF y CDF lado a lado
alpha_comp <- 2.5
lambda_comp <- 1.2

x_comp <- seq(0, 8, length.out = 1000)
pdf_vals <- dgamma(x_comp, shape = alpha_comp, rate = lambda_comp)
cdf_vals <- pgamma(x_comp, shape = alpha_comp, rate = lambda_comp)

# Crear dataframe para comparaci√≥n
df_comparacion <- data.frame(
  x = rep(x_comp, 2),
  y = c(pdf_vals, cdf_vals),
  tipo = rep(c("PDF: f(x)", "CDF: F(x)"), each = length(x_comp))
)

ggplot(df_comparacion, aes(x = x, y = y)) +
  geom_line(linewidth = 1.2, color = "blue") +
  facet_wrap(~tipo, scales = "free_y", ncol = 2) +
  labs(title = paste("Comparaci√≥n PDF vs CDF: Gamma(", alpha_comp, ",", lambda_comp, ")"),
       x = "x", y = "Valor de la funci√≥n") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))
```

## Cuantiles de la Distribuci√≥n Gamma

El cuantil $x_p$ se define como el valor que satisface: $$F(x_p) = p$$

No existe una forma cerrada para la funci√≥n cuantil gamma, por lo que se calculan num√©ricamente.

```{r}
#| label: cuantiles_gamma

# Mostrar cuantiles en el gr√°fico de CDF
alpha_q <- 3
lambda_q <- 1.5
x_q <- seq(0, 6, length.out = 1000)
cdf_q <- pgamma(x_q, shape = alpha_q, rate = lambda_q)

# Cuantiles espec√≠ficos
p_vals <- c(0.25, 0.5, 0.75)
q_vals <- qgamma(p_vals, shape = alpha_q, rate = lambda_q)

# Crear puntos para los cuantiles
df_cuantiles <- data.frame(
  x = q_vals,
  y = p_vals,
  etiqueta = paste0("Q", p_vals*100, " = ", round(q_vals, 2))
)

ggplot(data.frame(x = x_q, y = cdf_q), aes(x = x, y = y)) +
  geom_line(linewidth = 1.5, color = "blue") +
  geom_hline(yintercept = p_vals, linetype = "dashed", color = "red", alpha = 0.7) +
  geom_vline(xintercept = q_vals, linetype = "dashed", color = "red", alpha = 0.7) +
  geom_point(data = df_cuantiles, aes(x = x, y = y), 
             color = "red", size = 3) +
  geom_label(data = df_cuantiles, aes(x = x, y = y, label = etiqueta),
            vjust = -0.5, hjust = 0.5, size = 3.5) +
  labs(title = paste("Cuantiles en la CDF: Gamma(", alpha_q, ",", lambda_q, ")"),
       x = "x", y = "F(x)") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5)) +
  ylim(0, 1)
```

## C√°lculo de Probabilidades

Para calcular probabilidades en intervalos, utilizamos la propiedad fundamental:

$$P(a < X \leq b) = F(b) - F(a)$$

### Visualizaci√≥n del √Årea Bajo la Curva

**Probabilidad** $P(1.5 < X \leq 3.5)$

```{r}
#| label: area_bajo_curva_1
alpha_prob <- 2.5
lambda_prob <- 1.2
a_val <- 1.5
b_val <- 3.5

# Crear visualizaci√≥n del √°rea bajo la curva
x_area <- seq(0, 6, length.out = 1000)
pdf_area <- dgamma(x_area, shape = alpha_prob, rate = lambda_prob)

# Identificar el √°rea de inter√©s
x_intervalo <- x_area[x_area > a_val & x_area <= b_val]
pdf_intervalo <- pdf_area[x_area > a_val & x_area <= b_val]
prob_intervalo <- pgamma(b_val, alpha_prob, lambda_prob) - pgamma(a_val, alpha_prob, lambda_prob)

# Crear el gr√°fico
ggplot(data.frame(x = x_area, y = pdf_area), aes(x = x, y = y)) +
  geom_line(linewidth = 1.5, color = "blue") +
  geom_area(data = data.frame(x = x_intervalo, y = pdf_intervalo),
            aes(x = x, y = y), fill = "red", alpha = 0.3) +
  geom_vline(xintercept = c(a_val, b_val), linetype = "dashed", color = "red", linewidth = 1) +
  annotate("text", x = mean(c(a_val, b_val)), y = max(pdf_area) * 0.3,
           label = paste("P(", a_val, "< X ‚â§", b_val, ") =", round(prob_intervalo, 3)),
           size = 5, color = "black", fontface = "bold") +
  labs(title = "C√°lculo de Probabilidades usando √Årea Bajo la Curva",
       subtitle = paste("Distribuci√≥n Gamma(", alpha_prob, ",", lambda_prob, ")"),
       x = "x", y = "f(x)",
       caption = "El √°rea sombreada representa la probabilidad del intervalo") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```

**Probabilidades Inferior y Superior**

```{r areas-cola}
# Visualizar probabilidades
x_supinf <- seq(0, 8, length.out = 1000)
pdf_supinf <- dgamma(x_supinf, shape = alpha_prob, rate = lambda_prob)

# Punto de corte superior
corte_superior <- 4

# √Åreas 
x_inf <- x_supinf[x_supinf <= a_val]
pdf_inf <- pdf_supinf[x_supinf <= a_val]

x_sup <- x_supinf[x_supinf > corte_superior]
pdf_sup <- pdf_supinf[x_supinf > corte_superior]

# Probabilidades correspondientes
prob_inf <- pgamma(a_val, alpha_prob, lambda_prob)
prob_sup <- 1 - pgamma(corte_superior, alpha_prob, lambda_prob)

# Crear gr√°fico de colas
ggplot(data.frame(x = x_supinf, y = pdf_supinf), aes(x = x, y = y)) +
  geom_line(linewidth = 1.5, color = "blue") +
  geom_area(data = data.frame(x = x_inf, y = pdf_inf),
            aes(x = x, y = y), fill = "green", alpha = 0.4) +
  geom_area(data = data.frame(x = x_sup, y = pdf_sup),
            aes(x = x, y = y), fill = "orange", alpha = 0.4) +
  geom_vline(xintercept = c(a_val, corte_superior), 
             linetype = "dashed", color = c("green", "orange"), linewidth = 1) +
  annotate("label", x = a_val/2, y = max(pdf_supinf) * 0.5,
           label = paste("P(X ‚â§", a_val, ") =", round(prob_inf, 3)),
           size = 4, color = "green", fontface = "bold") +
  annotate("label", x = corte_superior + 1, y = max(pdf_supinf) * 0.3,
           label = paste("P(X >", corte_superior, ") =", round(prob_sup, 3)),
           size = 4, color = "orange", fontface = "bold") +
  labs(title = "Probabilidades en la Distribuci√≥n Gamma",
       subtitle = paste("Gamma(", alpha_prob, ",", lambda_prob, ")"),
       x = "x", y = "f(x)") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```

## Medidas Descriptivas de la Distribuci√≥n Gamma

**Media (Esperanza)**

La media de una distribuci√≥n gamma $X \sim \text{gamma}(\alpha, \lambda)$ se calcula como:

$$E(X) = \int_{0}^{\infty} x \cdot f(x) dx$$

Sustituyendo la funci√≥n de densidad:

$$E(X) = \int_{0}^{\infty} x \cdot \frac{\lambda^\alpha}{\Gamma(\alpha)} x^{\alpha-1} e^{-\lambda x} dx$$

$$= \frac{\lambda^\alpha}{\Gamma(\alpha)} \int_{0}^{\infty} x^\alpha e^{-\lambda x} dx$$

Para resolver esta integral, utilizamos la sustituci√≥n $u = \lambda x$, donde $du = \lambda dx$ y $x = u/\lambda$:

$$E(X) = \frac{\lambda^\alpha}{\Gamma(\alpha)} \int_{0}^{\infty} \left(\frac{u}{\lambda}\right)^\alpha e^{-u} \frac{du}{\lambda}$$

$$= \frac{\lambda^\alpha}{\Gamma(\alpha)} \cdot \frac{1}{\lambda^{\alpha+1}} \int_{0}^{\infty} u^\alpha e^{-u} du$$

$$= \frac{1}{\lambda \cdot \Gamma(\alpha)} \int_{0}^{\infty} u^\alpha e^{-u} du$$

Reconocemos que $\int_{0}^{\infty} u^\alpha e^{-u} du = \Gamma(\alpha + 1)$, y usando la propiedad de recurrencia $\Gamma(\alpha + 1) = \alpha \cdot \Gamma(\alpha)$:

$$E(X) = \frac{1}{\lambda \cdot \Gamma(\alpha)} \cdot \alpha \cdot \Gamma(\alpha) = \frac{\alpha}{\lambda}$$

es decir,

$$E(X) = \mu = \frac{\alpha}{\lambda}$$

**Interpretaci√≥n:**

-   La media es **directamente proporcional** al par√°metro de forma $\alpha$
-   La media es **inversamente proporcional** al par√°metro de tasa $\lambda$
-   Si $\alpha$ aumenta (manteniendo $\lambda$ fijo), la distribuci√≥n se desplaza hacia la derecha
-   Si $\lambda$ aumenta (manteniendo $\alpha$ fijo), la distribuci√≥n se concentra hacia valores menores

```{r visualizacion-media}
# Visualizar el efecto de los par√°metros en la media
x_vals <- seq(0, 8, length.out = 1000)

# Efecto de Œ± en la media (Œª fijo)
lambda_fijo <- 1.5
alphas <- c(1, 2, 3, 4)

df_alpha_media <- data.frame()
for (a in alphas) {
  media_a <- a / lambda_fijo
  temp <- data.frame(
    x = x_vals,
    y = dgamma(x_vals, shape = a, rate = lambda_fijo),
    parametro = paste("Œ± =", a),
    media = media_a,
    tipo = "Efecto de Œ± (Œª = 1.5)"
  )
  df_alpha_media <- rbind(df_alpha_media, temp)
}

# Efecto de Œª en la media (Œ± fijo)
alpha_fijo <- 3
lambdas <- c(0.8, 1.2, 1.8, 2.4)

df_lambda_media <- data.frame()
for (b in lambdas) {
  media_b <- alpha_fijo / b
  temp <- data.frame(
    x = x_vals,
    y = dgamma(x_vals, shape = alpha_fijo, rate = b),
    parametro = paste("Œª =", b),
    media = media_b,
    tipo = "Efecto de Œª (Œ± = 3)"
  )
  df_lambda_media <- rbind(df_lambda_media, temp)
}

# Combinar datos
df_medias <- rbind(df_alpha_media, df_lambda_media)

# Crear gr√°fico
ggplot(df_medias, aes(x = x, y = y, color = parametro)) +
  geom_line(linewidth = 1.2) +
  geom_vline(aes(xintercept = media, color = parametro), 
             linetype = "dashed", alpha = 0.7) +
  facet_wrap(~tipo, scales = "free", ncol = 2) +
  labs(title = "Efecto de los Par√°metros en la Media de la Distribuci√≥n Gamma",
       subtitle = "Las l√≠neas verticales indican las medias te√≥ricas",
       x = "x", y = "f(x)",
       color = "Par√°metro") +
  scale_color_brewer(palette="Dark2")+
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```

**Varianza**

La varianza de la distribuci√≥n gamma se calcular√° usando la f√≥rmula:

$$\text{Var}(X) = E[X^2] - (E[X])^2$$

C√°lculo de $E(X^2)$

Primero necesitamos calcular el segundo momento:

$$E(X^2) = \int_{0}^{\infty} x^2 \cdot \frac{\lambda^\alpha}{\Gamma(\alpha)} x^{\alpha-1} e^{-\lambda x} dx$$

$$= \frac{\lambda^\alpha}{\Gamma(\alpha)} \int_{0}^{\infty} x^{\alpha+1} e^{-\lambda x} dx$$

Usando la misma sustituci√≥n $u = \lambda x$:

$$E(X^2) = \frac{\lambda^\alpha}{\Gamma(\alpha)} \cdot \frac{1}{\lambda^{\alpha+2}} \int_{0}^{\infty} u^{\alpha+1} e^{-u} du$$

$$= \frac{1}{\lambda^2 \cdot \Gamma(\alpha)} \int_{0}^{\infty} u^{\alpha+1} e^{-u} du$$

$$= \frac{1}{\lambda^2 \cdot \Gamma(\alpha)} \cdot \Gamma(\alpha + 2)$$

Usando $\Gamma(\alpha + 2) = (\alpha + 1) \cdot \alpha \cdot \Gamma(\alpha)$:

$$E(X^2) = \frac{(\alpha + 1) \cdot \alpha \cdot \Gamma(\alpha)}{\lambda^2 \cdot \Gamma(\alpha)} = \frac{\alpha(\alpha + 1)}{\lambda^2}$$

Ahora, calculamos la varianza: $$\text{Var}(X) = E(X^2) - E(X)^2 = \frac{\alpha(\alpha + 1)}{\lambda^2} - \left(\frac{\alpha}{\lambda}\right)^2$$

$$= \frac{\alpha(\alpha + 1)}{\lambda^2} - \frac{\alpha^2}{\lambda^2} = \frac{\alpha(\alpha + 1) - \alpha^2}{\lambda^2}$$

$$= \frac{\alpha^2 + \alpha - \alpha^2}{\lambda^2} = \frac{\alpha}{\lambda^2}$$

es decir, $$\text{Var}(X) = \sigma^2 = \frac{\alpha}{\lambda^2}$$

**Interpretaci√≥n:**

-   La varianza es **proporcional** al par√°metro de forma $\alpha$
-   La varianza es **inversamente proporcional** al cuadrado del par√°metro de tasa $\lambda$
-   Mayor $\alpha$ implica mayor dispersi√≥n (para $\lambda$ fijo)
-   Mayor $\lambda$ implica menor dispersi√≥n (concentraci√≥n hacia valores menores)

**Desviaci√≥n Est√°ndar**

La desviaci√≥n est√°ndar es la ra√≠z cuadrada positiva de la varianza:

$$\sigma = \sqrt{\text{Var}(X)} = \sqrt{\frac{\alpha}{\lambda^2}} = \frac{\sqrt{\alpha}}{\lambda}$$

**Coeficiente de Variaci√≥n**

El coeficiente de variaci√≥n (CV) es una medida de dispersi√≥n relativa:

$$CV = \frac{\sigma}{\mu} = \frac{\frac{\sqrt{\alpha}}{\lambda}}{\frac{\alpha}{\lambda}} = \frac{\sqrt{\alpha}}{\alpha} = \frac{1}{\sqrt{\alpha}}$$

**Interpretaci√≥n del CV:**

-   El coeficiente de variaci√≥n **solo depende del par√°metro de forma** $\alpha$
-   Es **independiente del par√°metro de tasa** $\lambda$
-   A mayor $\alpha$, menor variabilidad relativa
-   Para $\alpha = 1$ (exponencial): $CV = 1$
-   Para $\alpha \to \infty$: $CV \to 0$ (distribuci√≥n muy concentrada)

### Ejemplo Num√©rico Completo

```{r ejemplo-completo}
# Ejemplo con Gamma(3, 1.5)
alpha_ej <- 3
lambda_ej <- 1.5

# Calcular todas las medidas
media_ej <- alpha_ej / lambda_ej
mediana_ej <- qgamma(0.5, alpha_ej, lambda_ej)
varianza_ej <- alpha_ej / lambda_ej^2
desv_std_ej <- sqrt(varianza_ej)
cv_ej <- 1 / sqrt(alpha_ej)

# Crear resumen num√©rico
resumen_numerico <- data.frame(
  Medida = c("Media", "Mediana", "Varianza", "Desviaci√≥n Est√°ndar", "Coeficiente de Variaci√≥n"),
  `Valor` = round(c(media_ej, mediana_ej, varianza_ej, desv_std_ej, cv_ej), 4),
  `Interpretaci√≥n` = c(
    paste("En promedio, X =", round(media_ej, 2)),
    paste("50% de valores ‚â§", round(mediana_ej, 2)),
    paste("Variabilidad =", round(desv_std_ej, 2), "¬≤"),
    paste("Dispersi√≥n t√≠pica =", round(desv_std_ej, 2)),
    paste("Variabilidad relativa =", round(cv_ej*100, 1), "%")
  ),
  check.names = FALSE
)

kable(resumen_numerico,
      caption = paste("Ejemplo num√©rico: Gamma(", alpha_ej, ",", lambda_ej, ")")) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))

# Visualizaci√≥n del ejemplo
x_ejemplo <- seq(0, 6, length.out = 1000)
pdf_ejemplo <- dgamma(x_ejemplo, alpha_ej, lambda_ej)

ggplot(data.frame(x = x_ejemplo, y = pdf_ejemplo), aes(x = x, y = y)) +
  geom_line(linewidth = 1.5, color = "blue") +
  geom_vline(xintercept = media_ej, color = "red", linewidth = 1.2, linetype = "solid") +
  geom_vline(xintercept = mediana_ej, color = "green", linewidth = 1.2, linetype = "dashed") +
  geom_vline(xintercept = c(media_ej - desv_std_ej, media_ej + desv_std_ej), 
             color = "orange", linewidth = 1, linetype = "dotted") +
  annotate("text", x = media_ej + 0.2, y = max(pdf_ejemplo) * 0.8,
           label = paste("Media =", round(media_ej, 2)), color = "red", size = 4) +
  annotate("text", x = mediana_ej + 0.2, y = max(pdf_ejemplo) * 0.6,
           label = paste("Mediana =", round(mediana_ej, 2)), color = "green", size = 4) +
  annotate("text", x = media_ej + desv_std_ej + 0.2, y = max(pdf_ejemplo) * 0.4,
           label = paste("Œº ¬± œÉ"), color = "orange", size = 4) +
  labs(title = paste("Medidas Descriptivas: Gamma(", alpha_ej, ",", lambda_ej, ")"),
       x = "x", y = "f(x)",
       caption = "L√≠nea roja: Media | L√≠nea verde: Mediana | L√≠neas naranjas: Œº ¬± œÉ") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))
```

## Simulaci√≥n y Comparaci√≥n con Valores Te√≥ricos

En esta secci√≥n generaremos muestras aleatorias de la distribuci√≥n gamma y compararemos los estad√≠sticos muestrales con los par√°metros te√≥ricos conocidos.

**Par√°metros de la Distribuci√≥n**

Consideremos una distribuci√≥n $\text{gamma}(\alpha = 3, \lambda = 1.5)$ para nuestras simulaciones:

```{r parametros-simulacion}
# Par√°metros de la distribuci√≥n gamma
alpha_sim <- 3
lambda_sim <- 1.5

# Par√°metros te√≥ricos
media_teorica <- alpha_sim / lambda_sim
varianza_teorica <- alpha_sim / lambda_sim^2
desv_std_teorica <- sqrt(varianza_teorica)
mediana_teorica <- qgamma(0.5, shape = alpha_sim, rate = lambda_sim)
cv_teorico <- 1 / sqrt(alpha_sim)

cat("=== PAR√ÅMETROS TE√ìRICOS ===\n")
cat("Distribuci√≥n: Gamma(Œ± =", alpha_sim, ", Œª =", lambda_sim, ")\n")
cat("Media te√≥rica:", round(media_teorica, 4), "\n")
cat("Varianza te√≥rica:", round(varianza_teorica, 4), "\n")
cat("Desviaci√≥n est√°ndar te√≥rica:", round(desv_std_teorica, 4), "\n")
cat("Mediana te√≥rica:", round(mediana_teorica, 4), "\n")
cat("Coeficiente de variaci√≥n te√≥rico:", round(cv_teorico, 4), "\n")
```

**Simulaci√≥n con diferentes tama√±os de muestra:** Convergencia de estad√≠sticos muestrales

```{r}
# Diferentes tama√±os de muestra
tama√±os_muestra <- c(50, 100, 500, 1000, 5000, 10000)

# Funci√≥n para calcular estad√≠sticos muestrales
calcular_estadisticos_gamma <- function(n, alpha, lambda) {
  muestra <- rgamma(n, shape = alpha, rate = lambda)
  
  return(data.frame(
    n = n,
    media_muestral = mean(muestra),
    varianza_muestral = var(muestra),
    desv_std_muestral = sd(muestra),
    mediana_muestral = median(muestra),
    cv_muestral = sd(muestra) / mean(muestra),
    min_muestral = min(muestra),
    max_muestral = max(muestra),
    q1_muestral = quantile(muestra, 0.25),
    q3_muestral = quantile(muestra, 0.75)
  ))
}

# Realizar simulaciones
resultados_simulacion <- do.call(rbind, lapply(tama√±os_muestra, calcular_estadisticos_gamma, 
                                              alpha = alpha_sim, lambda = lambda_sim))

# Agregar valores te√≥ricos y errores
resultados_simulacion$media_teorica <- media_teorica
resultados_simulacion$varianza_teorica <- varianza_teorica
resultados_simulacion$desv_std_teorica <- desv_std_teorica
resultados_simulacion$mediana_teorica <- mediana_teorica
resultados_simulacion$cv_teorico <- cv_teorico

# Calcular errores relativos
resultados_simulacion$error_media <- abs(resultados_simulacion$media_muestral - media_teorica) / media_teorica * 100
resultados_simulacion$error_varianza <- abs(resultados_simulacion$varianza_muestral - varianza_teorica) / varianza_teorica * 100
resultados_simulacion$error_mediana <- abs(resultados_simulacion$mediana_muestral - mediana_teorica) / mediana_teorica * 100

# Mostrar tabla de resultados
tabla_resultados <- resultados_simulacion[, c("n", "media_muestral", "media_teorica", "error_media",
                                              "varianza_muestral", "varianza_teorica", "error_varianza",
                                              "mediana_muestral", "mediana_teorica", "error_mediana")]

kable(tabla_resultados,
      caption = "Convergencia de estad√≠sticos muestrales hacia valores te√≥ricos",
      digits = 4,
      col.names = c("n", "Media Obs.", "Media Te√≥r.", "Error %",
                    "Var. Obs.", "Var. Te√≥r.", "Error %",
                    "Med. Obs.", "Med. Te√≥r.", "Error %")) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) 
```

<br>

**Visualizaci√≥n de la Convergencia (Ley de Grandes N√∫meros)**

```{r}
#| warning: false

# Generar una secuencia larga para observar convergencia
n_total <- 20000
muestra_larga <- rgamma(n_total, shape = alpha_sim, rate = lambda_sim)

# Calcular estad√≠sticos acumulados
indices <- 1:n_total
medias_acumuladas <- cumsum(muestra_larga) / indices
varianzas_acumuladas <- sapply(indices, function(i) var(muestra_larga[1:i]))

# Crear dataframe para gr√°ficos
df_convergencia <- data.frame(
  n = indices,
  media_acumulada = medias_acumuladas,
  varianza_acumulada = varianzas_acumuladas
)

# Gr√°fico de convergencia de la media
p1 <- ggplot(df_convergencia, aes(x = n)) +
  geom_line(aes(y = media_acumulada), color = "blue", alpha = 0.8) +
  geom_hline(yintercept = media_teorica, color = "red", linetype = "dashed", linewidth = 1) +
  labs(title = "Convergencia de la Media Muestral",
       x = "Tama√±o de muestra (n)",
       y = "Media acumulada",
       caption = paste("L√≠nea roja: Media te√≥rica =", round(media_teorica, 3))) +
  theme_minimal() +
  ylim(media_teorica - 0.3, media_teorica + 0.3)

# Gr√°fico de convergencia de la varianza
p2 <- ggplot(df_convergencia, aes(x = n)) +
  geom_line(aes(y = varianza_acumulada), color = "green", alpha = 0.8) +
  geom_hline(yintercept = varianza_teorica, color = "red", linetype = "dashed", linewidth = 1) +
  labs(title = "Convergencia de la Varianza Muestral",
       x = "Tama√±o de muestra (n)",
       y = "Varianza acumulada",
       caption = paste("L√≠nea roja: Varianza te√≥rica =", round(varianza_teorica, 3))) +
  theme_minimal() +
  ylim(varianza_teorica - 0.5, varianza_teorica + 0.5)

# Mostrar ambos gr√°ficos
grid.arrange(p1, p2, ncol = 2,
             top = "Ley de Grandes N√∫meros - Distribuci√≥n Gamma")
```

**Comparaci√≥n Histograma vs Densidad Te√≥rica**

```{r}
#| warning: false

# Generar muestra grande para comparaci√≥n visual
muestra_grande <- rgamma(8000, shape = alpha_sim, rate = lambda_sim)

# Crear histograma con densidad te√≥rica superpuesta
ggplot(data.frame(x = muestra_grande), aes(x = x)) +
  geom_histogram(aes(y = after_stat(density)), bins = 50, 
                 fill = "lightblue", color = "black", alpha = 0.7) +
  stat_function(fun = dgamma, args = list(shape = alpha_sim, rate = lambda_sim),
                color = "red", linewidth = 2) +
  geom_vline(xintercept = media_teorica, color = "red", linetype = "dashed", linewidth = 1) +
  geom_vline(xintercept = median(muestra_grande), color = "blue", linetype = "dotted", linewidth = 1) +
  labs(title = "Histograma de Muestra vs Densidad Te√≥rica",
       subtitle = paste("8000 observaciones de Gamma(", alpha_sim, ",", lambda_sim, ")"),
       x = "Valores",
       y = "Densidad",
       caption = "Curva roja: Densidad te√≥rica | L√≠nea roja: Media te√≥rica | L√≠nea azul: Mediana muestral") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5)) +
  xlim(0, 8)
```

## Ejercicios Propuestos

::: {#exr-TCL_gamma}
### Simulaci√≥n y Teorema Central del L√≠mite

-   Genera 1000 muestras de tama√±os $n= 5, 10, 20, 30, 50, 100$ de una distribuci√≥n $\text{gamma}(\alpha = 2.5, \lambda = 1.8)$.
-   Calcula la media muestral para cada muestra y comp√°rala con la media te√≥rica.
-   Calcula la varianza de las medias muestrales y comp√°rala con la varianza te√≥rica dividida por $n$.
-   Grafica los histogramas de las medias muestrales y superpone la distribuci√≥n normal te√≥rica seg√∫n el TCL.

```{r}
# ==============================================================================
# VERIFICACI√ìN DEL TEOREMA DEL L√çMITE CENTRAL CON DISTRIBUCI√ìN GAMMA
# ==============================================================================

# Instalaci√≥n del paquete necesario (descomentar y ejecutar si no est√° instalado)
# install.packages("e1071")
library(e1071) # Necesario para las funciones 'skewness' y 'kurtosis'

## 1. Definici√≥n de Par√°metros y C√°lculo de Valores Te√≥ricos ‚öôÔ∏è

# Par√°metros de la distribuci√≥n Gamma
alpha <- 2.5 # Par√°metro de forma (shape)
lambda <- 1.8 # Par√°metro de raz√≥n (rate)
n_muestras_simulacion <- 1000 # N√∫mero de medias muestrales a generar
tamanios_muestra <- c(5, 10, 20, 30, 50, 100) # Tama√±os de muestra (n)

# Propiedades Te√≥ricas de la Distribuci√≥n Gamma(alpha, lambda):
# Media Te√≥rica (mu): alpha / lambda
mu_teorica <- alpha / lambda
# Varianza Te√≥rica (sigma^2): alpha / lambda^2
sigma2_teorica <- alpha / (lambda^2)

cat("--- Par√°metros y Propiedades Te√≥ricas de la Distribuci√≥n Gamma ---\n")
cat(sprintf("Gamma(alpha=%.1f, lambda=%.1f)\n", alpha, lambda))
cat(sprintf("Media Te√≥rica de la Poblaci√≥n (mu): %.4f\n", mu_teorica))
cat(sprintf("Varianza Te√≥rica de la Poblaci√≥n (sigma^2): %.4f\n", sigma2_teorica))
cat("------------------------------------------------------------------\n\n")

# Almacenamiento de resultados
resultados_tcl <- data.frame(
  n = tamanios_muestra,
  Media_Muestral_Promedio = NA,
  Varianza_Muestral = NA,
  Varianza_TCL_Teorica = NA,
  Skewness = NA,
  Kurtosis = NA
)

# Configuraci√≥n del gr√°fico para m√∫ltiples histogramas
# Usaremos 2 filas y 3 columnas para mostrar todos los n.
par(mfrow = c(2, 3), mar = c(4, 4, 2, 1))

# ==============================================================================
## 2. Simulaci√≥n, C√°lculo y Gr√°fica para Cada Tama√±o de Muestra üìä
# ==============================================================================

set.seed(42) # Para reproducibilidad

for (i in 1:length(tamanios_muestra)) {
  n <- tamanios_muestra[i]
  medias_muestrales <- numeric(n_muestras_simulacion)

  # Generar 1000 muestras y calcular su media
  for (j in 1:n_muestras_simulacion) {
    # Generar n muestras de la Gamma
    muestra_actual <- rgamma(n, shape = alpha, rate = lambda)
    # Almacenar la media de esa muestra
    medias_muestrales[j] <- mean(muestra_actual)
  }

  # --- C√°lculo de Estad√≠sticas (Puntos 2 y 3) ---
  
  # Media muestral promedio (de las 1000 medias)
  media_promedio_simulada <- mean(medias_muestrales)
  
  # Varianza de las medias muestrales
  varianza_muestral_simulada <- var(medias_muestrales)
  
  # Varianza te√≥rica del TCL: sigma^2 / n
  varianza_tcl_teorica <- sigma2_teorica / n
  
  # Almacenar resultados
  resultados_tcl$Media_Muestral_Promedio[i] <- media_promedio_simulada
  resultados_tcl$Varianza_Muestral[i] <- varianza_muestral_simulada
  resultados_tcl$Varianza_TCL_Teorica[i] <- varianza_tcl_teorica
  
  # An√°lisis de Normalidad
  resultados_tcl$Skewness[i] <- skewness(medias_muestrales)
  resultados_tcl$Kurtosis[i] <- kurtosis(medias_muestrales)

  
  # --- Gr√°fica del Histograma (Punto 4) ---
  
  # Crear Histograma de la distribuci√≥n de medias muestrales
  hist(medias_muestrales,
       breaks = 25,
       freq = FALSE,
       main = paste("n =", n),
       xlab = "Media Muestral",
       ylab = "Densidad",
       col = "#0072B250",
       xlim = c(min(medias_muestrales) * 0.9, max(medias_muestrales) * 1.1))

  # Superponer la distribuci√≥n Normal Te√≥rica seg√∫n el TCL
  # Par√°metros Normal Te√≥rica: N(mu, sigma^2/n)
  desviacion_estandar_tcl <- sqrt(varianza_tcl_teorica)
  
  curve(dnorm(x, mean = mu_teorica, sd = desviacion_estandar_tcl),
        add = TRUE,
        col = "#D55E00",
        lwd = 2)

  # Agregar leyenda para el primer gr√°fico
  if (i == 1) {
    legend("topright",
           legend = c("Media Muestral Simulada", "Normal Te√≥rica (TCL)"),
           fill = c("#0072B250", NA),
           lty = c(NA, 1),
           lwd = c(NA, 2),
           col = c(NA, "#D55E00"),
           bty = "n",
           cex = 0.8)
  }
}

# Restaurar la configuraci√≥n gr√°fica original
par(mfrow = c(1, 1), mar = c(5, 4, 4, 2) + 0.1)


# ==============================================================================
## 3. Resumen y Conclusi√≥n üìù
# ==============================================================================

cat("\n--- Resumen de Comparaci√≥n de Medias y Varianzas (TCL) ---\n")

# Mostrar resultados comparando te√≥ricos y simulados
print(resultados_tcl)

cat("\nConclusi√≥n de la Verificaci√≥n del TCL:\n")
cat("1. Media Muestral: El promedio de las 1000 medias muestrales (Media_Muestral_Promedio) es muy cercano a la Media Te√≥rica de la poblaci√≥n (%.4f), independientemente de 'n'.\n", mu_teorica)
cat("2. Varianza: La Varianza Muestral Simulada se reduce a medida que 'n' aumenta, y es muy cercana al valor te√≥rico del TCL (Varianza_TCL_Teorica = sigma^2 / n). Esto demuestra que las estimaciones de la media son m√°s precisas con muestras m√°s grandes.\n")
cat("3. Normalizaci√≥n: A medida que 'n' aumenta (especialmente a partir de n=30), la forma de los histogramas se vuelve perfectamente **normal** (acampanada y sim√©trica), y los valores de Skewness y Kurtosis se acercan a cero. La curva Normal Te√≥rica (roja) se ajusta perfectamente al histograma, lo que confirma el Teorema del L√≠mite Central.")
```
:::

::: {#exr-suma_exponenciales}
**Proposici√≥n** Sean $X_1, \dots, X_n$ variables aleatorias independientes e id√©nticamente distribuidas con distribuci√≥n exponencial $\text{exp}(\lambda)$. Entonces, la suma $Y = \sum_{i=1}^{n} X_i$ sigue una distribuci√≥n gamma $\text{gamma}(n, \lambda)$.

-   Simula 1000 sumas de $n=5$ variables aleatorias $\text{exp}(\lambda = 1.5)$.
-   Grafica el histograma de las sumas y superpone la densidad te√≥rica de $\text{gamma}(5, 1.5)$.
-   Repite el ejercicio para $n=10$ y $n=20$ y observa c√≥mo cambia la forma de la distribuci√≥n.

```{r}
# ==============================================================================
# VERIFICACI√ìN DE LA SUMA DE VARIABLES EXPONENCIALES (DISTRIBUCI√ìN GAMMA)
# ==============================================================================

# 1. Definici√≥n de Par√°metros
lambda <- 1.5           # Par√°metro de la distribuci√≥n Exponencial (rate)
n_simulaciones <- 1000  # N√∫mero de sumas a generar
tamanios_n <- c(5, 10, 20) # Tama√±os de muestra para las sumas (n)

set.seed(123) # Para reproducibilidad

# Configuraci√≥n del gr√°fico (1 fila, 3 columnas)
par(mfrow = c(1, 3), mar = c(4, 4, 3, 1))

cat("--- Verificaci√≥n de la Suma de Exponenciales (Lambda = 1.5) ---\n")
cat(sprintf("Simulando %d sumas para cada n\n", n_simulaciones))
cat("----------------------------------------------------------------\n")

# 2. Iteraci√≥n y Simulaci√≥n
for (n in tamanios_n) {
  
  # La densidad te√≥rica esperada es Gamma(n, lambda)
  shape_gamma <- n
  rate_gamma <- lambda
  
  # Generar una matriz de N_simulaciones filas y n columnas
  # Cada fila representa una muestra de n variables Exponencial(lambda)
  datos_exponenciales <- rexp(n_simulaciones * n, rate = lambda)
  matriz_exponenciales <- matrix(datos_exponenciales, ncol = n)
  
  # Calcular la suma de cada fila (la suma de n variables)
  sumas_simuladas <- rowSums(matriz_exponenciales)
  
  # --- C√°lculo de Estad√≠sticas para Confirmaci√≥n ---
  # Media Te√≥rica de Y: n / lambda
  media_teorica <- n / lambda
  media_simulada <- mean(sumas_simuladas)
  
  cat(sprintf("n = %d. Distribuci√≥n Te√≥rica: Gamma(shape=%.0f, rate=%.1f)\n", n, shape_gamma, rate_gamma))
  cat(sprintf("  Media Te√≥rica (n/Œª): %.4f | Media Simulada: %.4f\n", media_teorica, media_simulada))
  
  
  # --- Graficar Histograma y Superponer Densidad Te√≥rica ---
  
  # 1. Crear Histograma de Densidad (freq=FALSE)
  hist(sumas_simuladas,
       breaks = 30, # Ajuste de bins para mejor visualizaci√≥n
       freq = FALSE,
       main = paste("Suma de Exponenciales (n=", n, ")"),
       xlab = "Suma Y",
       ylab = "Densidad",
       col = "#0072B250")
  
  # 2. Superponer la densidad Gamma Te√≥rica
  # Generar puntos de la curva Gamma
  x_curva <- seq(min(sumas_simuladas), max(sumas_simuladas), length.out = 100)
  densidad_teorica <- dgamma(x_curva, shape = shape_gamma, rate = rate_gamma)
  
  lines(x_curva, densidad_teorica,
        col = "#D55E00",
        lwd = 2)
}

# Restaurar la configuraci√≥n gr√°fica original
par(mfrow = c(1, 1), mar = c(5, 4, 4, 2) + 0.1)

cat("----------------------------------------------------------------\n")
cat("Observaci√≥n:\n")
cat("A medida que 'n' aumenta (de 5 a 20):\n")
cat("1. La distribuci√≥n de la suma (Gamma) se vuelve **m√°s sim√©trica y acampanada**.\n")
cat("2. La **varianza** (dispersi√≥n) de las sumas **aumenta** (el rango del histograma se expande).\n")
cat("3. El pico del histograma se desplaza hacia la derecha, ya que la media de la Gamma es n/Œª.\n")
cat("\nEsta simulaci√≥n confirma que la suma de n variables Exponenciales i.i.d. sigue una Gamma(n, Œª).\n")

```
:::
